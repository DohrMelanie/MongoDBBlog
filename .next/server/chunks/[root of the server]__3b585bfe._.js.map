{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///home/laflame/Documents/School-Git/mongo/task3/src/utils/mongo.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\";\n\nconst uri = process.env.MONGODB_URI || \"mongodb://localhost:27017\";\nconst client = new MongoClient(uri);\nconst db = client.db(\"blog\");\n\nexport default db;"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW,IAAI;AACvC,MAAM,SAAS,IAAI,uGAAA,CAAA,cAAW,CAAC;AAC/B,MAAM,KAAK,OAAO,EAAE,CAAC;uCAEN","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///home/laflame/Documents/School-Git/mongo/task3/src/utils/auth.ts"],"sourcesContent":["import { UserCreationData, UserDetails } from \"@/models/auth\";\nimport db from \"./mongo\";\nimport { createHash } from \"crypto\";\n\nclass AuthManager {\n    async addUser(user: UserCreationData) {\n        const hash = createHash(\"sha256\").update(user.password).digest(\"hex\");\n\n        await db.collection(\"users\").insertOne({ username: user.username, password: hash, email: user.email, name: user.name, isVerified: false });\n    }\n\n    async verifyUserAccount(username: string) {\n        await db.collection(\"users\").updateOne({ username }, { $set: { isVerified: true } });\n    }\n\n    async verifyUser(username: string, password: string) {\n        const user = await db.collection(\"users\").findOne({ username });\n\n        if (!user) {\n            return false;\n        }\n\n        const hash = createHash(\"sha256\").update(password).digest(\"hex\");\n\n        return user.password === hash;\n    }\n\n    async getUserDetails(username: string) : Promise<UserDetails | null> {\n        return await db.collection(\"users\").findOne({ username }, { projection: { password: 0 } }) as UserDetails | null;\n    }\n}\n\nexport default new AuthManager();"],"names":[],"mappings":";;;AACA;AACA;;;AAEA,MAAM;IACF,MAAM,QAAQ,IAAsB,EAAE;QAClC,MAAM,OAAO,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD,EAAE,UAAU,MAAM,CAAC,KAAK,QAAQ,EAAE,MAAM,CAAC;QAE/D,MAAM,uHAAA,CAAA,UAAE,CAAC,UAAU,CAAC,SAAS,SAAS,CAAC;YAAE,UAAU,KAAK,QAAQ;YAAE,UAAU;YAAM,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;YAAE,YAAY;QAAM;IAC5I;IAEA,MAAM,kBAAkB,QAAgB,EAAE;QACtC,MAAM,uHAAA,CAAA,UAAE,CAAC,UAAU,CAAC,SAAS,SAAS,CAAC;YAAE;QAAS,GAAG;YAAE,MAAM;gBAAE,YAAY;YAAK;QAAE;IACtF;IAEA,MAAM,WAAW,QAAgB,EAAE,QAAgB,EAAE;QACjD,MAAM,OAAO,MAAM,uHAAA,CAAA,UAAE,CAAC,UAAU,CAAC,SAAS,OAAO,CAAC;YAAE;QAAS;QAE7D,IAAI,CAAC,MAAM;YACP,OAAO;QACX;QAEA,MAAM,OAAO,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD,EAAE,UAAU,MAAM,CAAC,UAAU,MAAM,CAAC;QAE1D,OAAO,KAAK,QAAQ,KAAK;IAC7B;IAEA,MAAM,eAAe,QAAgB,EAAgC;QACjE,OAAO,MAAM,uHAAA,CAAA,UAAE,CAAC,UAAU,CAAC,SAAS,OAAO,CAAC;YAAE;QAAS,GAAG;YAAE,YAAY;gBAAE,UAAU;YAAE;QAAE;IAC5F;AACJ;uCAEe,IAAI","debugId":null}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///home/laflame/Documents/School-Git/mongo/task3/src/components/mailing/VerificationTemplate.tsx"],"sourcesContent":["import { Html } from \"@react-email/components\";\n\ninterface VerificationTemplateProps {\n    username: string;\n    verificationCode: string;\n}\n\nexport default function VerificationTemplate({ username, verificationCode }: VerificationTemplateProps) {\n    return (\n        <Html>\n            <h1>Welcome to Rich Money Blogs, {username}!</h1>\n            <p>Please verify your email by entering the code below:</p>\n            <p className=\"text-2xl font-bold text-secondary-700 tracking-wider\">{verificationCode}</p>\n        </Html>\n    );\n}"],"names":[],"mappings":";;;;AAAA;;;AAOe,SAAS,qBAAqB,EAAE,QAAQ,EAAE,gBAAgB,EAA6B;IAClG,qBACI,gPAAC,4JAAA,CAAA,OAAI;;0BACD,gPAAC;;oBAAG;oBAA8B;oBAAS;;;;;;;0BAC3C,gPAAC;0BAAE;;;;;;0BACH,gPAAC;gBAAE,WAAU;0BAAwD;;;;;;;;;;;;AAGjF","debugId":null}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///home/laflame/Documents/School-Git/mongo/task3/src/utils/code-manager.ts"],"sourcesContent":["import db from \"./mongo\";\n\nclass CodeManager {\n    async generateCode(username: string) {\n        const code = Math.floor(100000 + Math.random() * 900000).toString();\n\n        await db.collection(\"codes\").insertOne({ username, code });\n\n        return code;\n    }\n\n    async verifyCode(username: string, code: string) {\n        const result = await db.collection(\"codes\").findOne({ username, code });\n\n        return result !== null;\n    }\n\n    async deleteCode(username: string) {\n        await db.collection(\"codes\").deleteOne({ username });\n    }\n}\n\nexport default new CodeManager();"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM;IACF,MAAM,aAAa,QAAgB,EAAE;QACjC,MAAM,OAAO,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;QAEjE,MAAM,uHAAA,CAAA,UAAE,CAAC,UAAU,CAAC,SAAS,SAAS,CAAC;YAAE;YAAU;QAAK;QAExD,OAAO;IACX;IAEA,MAAM,WAAW,QAAgB,EAAE,IAAY,EAAE;QAC7C,MAAM,SAAS,MAAM,uHAAA,CAAA,UAAE,CAAC,UAAU,CAAC,SAAS,OAAO,CAAC;YAAE;YAAU;QAAK;QAErE,OAAO,WAAW;IACtB;IAEA,MAAM,WAAW,QAAgB,EAAE;QAC/B,MAAM,uHAAA,CAAA,UAAE,CAAC,UAAU,CAAC,SAAS,SAAS,CAAC;YAAE;QAAS;IACtD;AACJ;uCAEe,IAAI","debugId":null}},
    {"offset": {"line": 368, "column": 0}, "map": {"version":3,"sources":["file:///home/laflame/Documents/School-Git/mongo/task3/src/utils/mailer.ts"],"sourcesContent":["import VerificationTemplate from \"@/components/mailing/VerificationTemplate\";\nimport CodeManager from \"./code-manager\";\nimport nodemailer from \"nodemailer\";\nimport { render } from \"@react-email/components\";\n\nclass Mailer {\n    private transporter: nodemailer.Transporter;\n\n    constructor() {\n        this.transporter = nodemailer.createTransport({\n            host: process.env.NODEMAILER_HOST,\n            port: parseInt(process.env.NODEMAILER_PORT || '587', 10),\n            secure: false,\n            auth: {\n                user: process.env.NODEMAILER_USER,\n                pass: process.env.NODEMAILER_PASS\n            }\n        });\n    }\n    async sendVerificationEmail(username: string, email: string) {\n        const verificationCode = await CodeManager.generateCode(username);\n\n        const html = await render(VerificationTemplate({ username, verificationCode }));\n\n        await this.transporter.sendMail({\n            from: \"Rich Money Blogs <richmoneyblogs@gmail.com>\",\n            to: email,\n            subject: \"Verification Code\",\n            html: html,\n        });\n\n        return true;\n    }\n}\n\nexport default new Mailer();"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA,MAAM;IACM,YAAoC;IAE5C,aAAc;QACV,IAAI,CAAC,WAAW,GAAG,iJAAA,CAAA,UAAU,CAAC,eAAe,CAAC;YAC1C,MAAM,QAAQ,GAAG,CAAC,eAAe;YACjC,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe,IAAI,OAAO;YACrD,QAAQ;YACR,MAAM;gBACF,MAAM,QAAQ,GAAG,CAAC,eAAe;gBACjC,MAAM,QAAQ,GAAG,CAAC,eAAe;YACrC;QACJ;IACJ;IACA,MAAM,sBAAsB,QAAgB,EAAE,KAAa,EAAE;QACzD,MAAM,mBAAmB,MAAM,iIAAA,CAAA,UAAW,CAAC,YAAY,CAAC;QAExD,MAAM,OAAO,MAAM,CAAA,GAAA,sKAAA,CAAA,SAAM,AAAD,EAAE,CAAA,GAAA,uJAAA,CAAA,UAAoB,AAAD,EAAE;YAAE;YAAU;QAAiB;QAE5E,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC;YAC5B,MAAM;YACN,IAAI;YACJ,SAAS;YACT,MAAM;QACV;QAEA,OAAO;IACX;AACJ;uCAEe,IAAI","debugId":null}},
    {"offset": {"line": 419, "column": 0}, "map": {"version":3,"sources":["file:///home/laflame/Documents/School-Git/mongo/task3/src/app/api/auth/route.ts"],"sourcesContent":["import { MandatoryUserData, UserCreationData } from \"@/models/auth\";\nimport { NextResponse } from \"next/server\";\nimport AuthManager from \"@/utils/auth\";\nimport mailer from \"@/utils/mailer\";\n\nexport async function POST(request: Request) {\n  const mandatoryUserData: MandatoryUserData = await request.json();\n\n  const isUserVerified = await AuthManager.verifyUser(mandatoryUserData.username, mandatoryUserData.password);\n\n  if (!isUserVerified) {\n    return NextResponse.json({ error: \"Invalid username or password\" }, { status: 401 });\n  }\n\n  const userData = await AuthManager.getUserDetails(mandatoryUserData.username);\n\n  if (!userData) {\n    return NextResponse.json({ error: \"User not found\" }, { status: 404 });\n  }\n\n  const isEmailSent = await mailer.sendVerificationEmail(userData.username, userData.email);\n\n  if (!isEmailSent) {\n    return NextResponse.json({ error: \"Failed to send verification email\" }, { status: 500 });\n  }\n\n  return NextResponse.json({ message: \"Verification email sent successfully\" }, { status: 200 });\n}\n\nexport async function PUT(request: Request) {\n  const userData: UserCreationData = await request.json();\n\n  const user = await AuthManager.getUserDetails(userData.username);\n\n  if (user) {\n    return NextResponse.json({ error: \"User already exists\" }, { status: 400 });\n  }\n\n  const isEmailSent = await mailer.sendVerificationEmail(userData.username, userData.email);\n\n  if (!isEmailSent) {\n    return NextResponse.json({ error: \"Failed to send verification email\" }, { status: 500 });\n  }\n\n  await AuthManager.addUser(userData);\n\n  return NextResponse.json({ message: \"User created successfully\" }, { status: 201 });\n}"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,MAAM,oBAAuC,MAAM,QAAQ,IAAI;IAE/D,MAAM,iBAAiB,MAAM,sHAAA,CAAA,UAAW,CAAC,UAAU,CAAC,kBAAkB,QAAQ,EAAE,kBAAkB,QAAQ;IAE1G,IAAI,CAAC,gBAAgB;QACnB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;IAEA,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAW,CAAC,cAAc,CAAC,kBAAkB,QAAQ;IAE5E,IAAI,CAAC,UAAU;QACb,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,MAAM,cAAc,MAAM,wHAAA,CAAA,UAAM,CAAC,qBAAqB,CAAC,SAAS,QAAQ,EAAE,SAAS,KAAK;IAExF,IAAI,CAAC,aAAa;QAChB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoC,GAAG;YAAE,QAAQ;QAAI;IACzF;IAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAuC,GAAG;QAAE,QAAQ;IAAI;AAC9F;AAEO,eAAe,IAAI,OAAgB;IACxC,MAAM,WAA6B,MAAM,QAAQ,IAAI;IAErD,MAAM,OAAO,MAAM,sHAAA,CAAA,UAAW,CAAC,cAAc,CAAC,SAAS,QAAQ;IAE/D,IAAI,MAAM;QACR,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;IAEA,MAAM,cAAc,MAAM,wHAAA,CAAA,UAAM,CAAC,qBAAqB,CAAC,SAAS,QAAQ,EAAE,SAAS,KAAK;IAExF,IAAI,CAAC,aAAa;QAChB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoC,GAAG;YAAE,QAAQ;QAAI;IACzF;IAEA,MAAM,sHAAA,CAAA,UAAW,CAAC,OAAO,CAAC;IAE1B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAA4B,GAAG;QAAE,QAAQ;IAAI;AACnF","debugId":null}}]
}